{% extends "admin/admin_base.html" %}
{% block content %}
<h3>User Management</h3>

<form method="get" class="row mb-3">
    <div class="col-md-8">
        <input type="text" name="search" class="form-control" value="{{ search }}" placeholder="Search users by username or emailâ€¦">
    </div>
    <div class="col-md-4">
        <button type="submit" class="btn btn-primary w-100">Search</button>
    </div>
</form>

<table class="table table-bordered table-hover">
    <thead>
        <tr>
            <th>Username</th>
            <th>Email</th>
            <th>Joined</th>
            <th>Books Uploaded</th>
            <th>Downloads</th>
            <th>Action</th>
        </tr>
    </thead>
    <tbody>
        {% for user in users %}
        <tr>
            <td>{{ user[1] }}</td> <!-- username -->
            <td>{{ user[2] }}</td> <!-- email -->
            <td>{{ user[4] }}</td> <!-- created_at -->
            <td>{{ user[7] }}</td> <!-- book_count -->
            <td>{{ user[8] }}</td> <!-- download_count -->
            <td>
                <form method="post" action="{{ url_for('admin_bp.delete_user', user_id=user[0]) }}" onsubmit="return confirm('Are you sure you want to delete this user?');">
                    <button type="submit" class="btn btn-sm btn-danger">Delete</button>
                </form>
            </td>
        </tr>
        {% else %}
        <tr>
            <td colspan="6" class="text-center">No users found.</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<div>
    <nav>
        <ul class="pagination">
            {% set total_pages = (total_users // per_page) + (1 if total_users % per_page > 0 else 0) %}
            {% for p in range(1, total_pages + 1) %}
            <li class="page-item {% if p == page %}active{% endif %}">
                <a class="page-link" href="{{ url_for('admin_bp.admin_users', page=p, search=search) }}">{{ p }}</a>
            </li>
            {% endfor %}
        </ul>
    </nav>
</div>
{% endblock %}
